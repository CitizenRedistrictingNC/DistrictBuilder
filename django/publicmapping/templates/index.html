<html>
  <head>
    <title>Welcome to PublicMapping</title>
    <link rel="stylesheet" type="text/css" href="/site-media/publicmapping.css"/>
    <link rel="stylesheet" type="text/css" href="/site-media/jquery/themes/ui-lightness/jquery-ui-1.8.2.custom.css"/>
  </head>
  <body>
    <div id="header_box">
        <div id="welcome_header">
          <h1>District Mapping</h1>
          <h2>Draw Your Own Legislative Districts</h2>
        </div>
    </div>

    <div id="body_box">
      <div id="tour_news">
        <div id="take_a_tour">
          <div>New to Redistricting?</div>
          <h3>Take a Tour</h3>
        </div>

        <div id="news">
          <span>Learn About Redistricting</span>
          <ul>
            <li>Frequently Asked Questions</li>
            <li>Quick Start Guide</li>
            <li>Redistricting Resources</li>
            <li>... more ...</li>
          </ul>
        </div>
      </div>

      <div id="user">
        <h2>Get Started</h2>

        <div id="login">
          <form action="/accounts/login/" method="post">
            <input type="hidden" name="next" value="/districtmapping/"/>
            <h3>Log In</h3>
            <table>
              <tr><td>Login:</td><td><input id="username" name="username"/></td></tr>
              <tr><td>Password:</td><td><input id="password" name="password" type="password"/></td></tr>
            </table>
            <input type="submit" value="Login"/>
          </form>
        </div>

        <div id="signup">
          <h3>Don't have an account?</h3>

          <div>To make your own maps...</div>
          <input type="button" value="Sign Up" onclick="$('#register').dialog('open');"/>

          <div>To view other users' maps...</div>
          <form id="anonymousForm" action="/accounts/register/" method="post">
            <input id="doAnonymous" type="button" value="Enter as a guest"/>
          </form>
        </div>
      </div>
    </div>
    <div id="register" title="Sign Up For An Account">
        <form id="registerForm" action="/accounts/register/" method="post">
            <table id="registerTable">
                <tr>
                    <td class="fname">User Name *</td>
                    <td><input id="newusername" name="newusername" class="field"/></td>
                </tr>
                <tr>
                    <td class="fname">Password *</td>
                    <td><input id="newpassword1" name="newpassword1" type="password" class="field"/></td>
                </tr>
                <tr>
                    <td class="fname">Confirm Password *</td>
                    <td><input id="newpassword2" name="newpassword2" type="password" class="field"/></td>
                </tr>
                <tr>
                    <td class="fname">Password Hint *</td>
                    <td><input id="passwordhint" name="passwordhint" class="field"/></td>
                </tr>
                <tr>
                    <td class="fname">Email Address</td>
                    <td><input id="email" name="email" class="field"/></td>
                </tr>
                <tr>
                    <td colspan="2"><span class="recommended">Recommended to allow you to recover a password you have lost.</span></td>
                </tr>
                <tr>
                    <td class="fname">First Name</td>
                    <td><input id="firstname" name="firstname" class="field"/></td>
                </tr>
                <tr>
                    <td class="fname">Last Name</td>
                    <td><input id="lastname" name="lastname" class="field"/></td>
                </tr>
                <tr>
                    <td class="fname">Organization</td>
                    <td><input id="organization" name="organization" class="field"/></td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <input id="agree" name="agree" type="checkbox"/>
                        <label id="agreelabel" for="agree">I have read the <a href="#">Privacy Policy</a> and <a href="#">Terms of Use</a></label>
                    </td>
                </tr>
            </table>
            <div id="signUpButton">
                <input id="doRegister" type="button" value="Sign Up"/>
            </div>
            <div id="requiredNote">
                * Indicates required field
            </div>
        </form>
    </div>
    <script type="text/javascript" src="/site-media/jquery/jquery-1.4.2.js"></script>
    <script type="text/javascript" src="/site-media/jquery/external/jquery.bgiframe-2.1.1.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.core.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.mouse.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.draggable.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.position.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.resizable.js"></script>
    <script type="text/javascript" src="/site-media/jquery/ui/jquery.ui.dialog.js"></script>
    <script type="text/javascript">
    $(function(){
        $('#register').dialog({'autoOpen':false,'width':350,'modal':true});
        $('#doRegister').click(function(evt) {
            var frm = $('#registerForm'),
                username = frm.find('#newusername'),
                newpassword1 = frm.find('#newpassword1'),
                newpassword2 = frm.find('#newpassword2'),
                passwordhint = frm.find('#passwordhint'),
                agree = frm.find('#agree');

            if (username.val() == '') {
                username.removeClass('field');
                username.addClass('error');
                return;
            }
            else {
                username.removeClass('error');
                username.addClass('field');
            }

            if (newpassword1.val() == '' ||
                newpassword1.val() != newpassword2.val()) {
                newpassword1.removeClass('field');
                newpassword1.addClass('error');
                newpassword2.removeClass('field');
                newpassword2.addClass('error');
                return;
            }
            else {
                newpassword1.removeClass('error');
                newpassword1.addClass('field');
                newpassword2.removeClass('error');
                newpassword2.addClass('field');
            }

            if (passwordhint.val() == '') {
                passwordhint.removeClass('field');
                passwordhint.addClass('error');
                return;
            }
            else {
                passwordhint.addClass('field');
                passwordhint.removeClass('error');
            }

            if (!agree[0].checked) {
                $('#agreelabel').addClass('required');
                return;
            }
            
            jQuery.ajax({
                context:frm[0],
                data: { 
                    newusername:$('#newusername').val(),
                    newpassword1:$('#newpassword1').val(),
                    newpassword2:$('#newpassword2').val(),
                    email:$('#email').val(),
                    passwordhint:$('#passwordhint').val(),
                    firstname:$('#firstname').val(),
                    lastname:$('#lastname').val(),
                    organization:$('#organization').val()
                },
                dataType:'json',
                type:'POST',
                url:frm[0].action,
                success:function(data,textStatus,xhr){
                    if (data.success) {
                        window.location.href = data.redirect;
                        return;
                    }

                    var newusername = $('#newusername');
                    newusername.removeClass('field');
                    newusername.addClass('error');
                },
                error:function(xhr,textStatus,error){
                    $('#doRegister').attr('disabled',true);
                }
            });
        });
        $('#doAnonymous').click(function(evt) {
            var frm = $('#anonymousForm')[0];
            jQuery.ajax({
                context:frm,
                data: {
                    newusername:'anonymous',
                    newpassword1:'anonymous',
                    email:''
                },
                dataType:'json',
                type:'POST',
                url:frm.action,
                success:function(data,textStatus,xhr){
                    if (data.success) {
                        window.location.href = data.redirect;
                        return;
                    }
                },
                error:function(xhr,textStatus,error){
                    $('#doAnonymous').attr('disabled',true);
                }
            });
        });
    });
    </script>
  </body>
</html>
