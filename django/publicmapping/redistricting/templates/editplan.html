{% extends "viewplan.html" %}

{% comment %}

   Copyright 2010 Micah Altman, Michael McDonald

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

   This file is part of The Public Mapping Project
   http://sourceforge.net/projects/publicmapping/

   Purpose:
       This template is a full featured editing interface.

       This template extends the map viewing interface, and adds editing
       tools and features to the toolbars.

   Author:
       Andrew Jennings, David Zwarg

{% endcomment %}

    {% block mode_toggle %}
    <button class="toolbar_toggle" id="start_drawing">Edit Map</button>
    {% endblock %}

      {% block toolset_draw %}
      <div class="toolset_group">
        <label>Selecting Tools</label>
        <div>
          <button id="single_drawing_tool" title="Single district select; +Shift to select multiple districts" class="btntoggle titletip" ></button>
          <button id="rectangle_drawing_tool" title="Select by rectangle" class="btntoggle titletip" ></button>
          <button id="polygon_drawing_tool" title="Select by drawing a polygon" class="btntoggle titletip"></button>
          <button id="district_select_tool" title="Unassign all the units in a district" class="btntoggle titletip"></button>
          <button id="copy_paste_tool" title="Copy a district from another plan" class="titletip"></button>
        </div>
      </div>
      <div class="toolset_group toolset_group_w">
        <label>Assigning Tools</label>
        <div>
          <button id="anchor_tool" class="titletip" title="Enable anchor mode, then select a district name to repeatedly assign areas to a district"></button>
          <select id="assign_district" class="titletip" title="Assign districts currently selected on map by choosing a district name from drop down list">
            <option value="-1">-- Select One --</option>
            {% for d in districts %}
                <option value="{{ d.district_id }}">{{ d.name }}</option>
            {% endfor %}
            {% ifnotequal max_dists districts|length %}
                <option value="new">New District</option>
            {% endifnotequal %}
          </select>
          <button id="dragdrop_tool" class="titletip" title="Select areas on the map then drag them to into a district for reassignment"></button>
        </div>
      </div>
      <div class="toolset_group">
        <label>History</label>
        <div>
          <button id="history_undo" class="{% if not plan %}disabled{% else %}{% ifequal plan.version 0 %}disabled{% endifequal %}{% endif %}"></button>
          <button id="history_redo" class="disabled"></button>
          <input id="history_cursor" type="hidden"/>
        </div>
      </div>
      {% endblock %}

        {% block share_panel %}
            <div class="explanation">
                <h3>Explanation of Shared Documents</h3>
                <p>You can share your plan with other users here.  Your plan will be available for other users so that they can view reports about your plan or create a plan of their own using yours as a base.</p>
                <p>Give your plan a unique name in order to share it. A copy of your current plan will be added to the "Shared Plans" section of the plan chooser.</p>
            </div>
            <div id="nameandshare">
                <div>
                    <h3>Name your shared plan</h3>
                    <input id="txtPlanName" />
                    <button id="btnSaveAndShare">Save and Share</button>
                </div>

            </div>
            <div id="successfulShare" title="Congratulations!" >
                <p>You have successfully shared your plan. You can share your plan with others by giving them this link:</p>
                <p id="sharedPermalink"><p>
                <button id="continueEditing">Continue Editing Current Plan</button>
                <a href="/districtmapping/plan/0/view/"><button id="selectNew">Select New Plan to Edit</button></a>
            </div>
        {% endblock %}

    {% block shared_districts %}
    <div id="shared_districts_dialog">
        <!-- <div id="header"><h3></h3></div> -->
        <div id="shared_districts_content">
            <div id="shared_districts_instructions">
            <p>Choose districts to paste into your plan.  A plan has a maximum number of districts allowed by law.  If you would like to paste districts into a plan, you must have fewer districts in your plan than the maximum allowed.  If you would like to remove districts from your plan, use the district unassign tool.</p>
            </div>
            <div id="shared_plans_column">
                <h2>1. Choose Plan</h2>
                <table id="shared_plans_table"></table>
                <div id="shared_plans_pager"></div>
            </div>
            <div id="shared_districts_column">
                <input type="hidden" id="available_districts">
                <h2>2. Select districts to copy</h2>
                <table id="shared_districts_table"></table>
                <div id="shared_districts_pager"></div>
            </div>
            <div id="shared_district_maps">
               <p>Click on a district's name to see a map</p>
               <div id='shared_district_map_div'></div>
            </div>
        </div>
        <div id="footer">
            <div id="message_box"></div>
            <div id="step_3">
                <h2>3. Paste selected districts into working plan</h2>
                <button id="paste_button">Paste</button>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/static-media/js/shareddistricts.js"></script>
    <script type="text/javascript">
        $(function() {
            var shared = shareddistricts({
                container: $('#shared_districts_dialog'),
                target: $('#copy_paste_tool'),
                planTable: $('#shared_plans_table'),
                planPager: $('#shared_plans_pager'),
                planUrl: '/districtmapping/getplans/',
                districtTable: $('#shared_districts_table'),
                districtPager: $('#shared_districts_pager'),
                districtUrl: '/districtmapping/plan/PLAN_ID/shareddistricts/',
                submitButton: $('#paste_button'),
                handlerUrl: '/districtmapping/plan/{{ plan.id }}/pastedistricts/',
                availableDistricts: {{ available_districts }}
            }).init();
        });
    </script>
    {% endblock %}
