{% comment %}

   Copyright 2010 Micah Altman, Michael McDonald

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

   This file is part of The Public Mapping Project
   http://sourceforge.net/projects/publicmapping/

   Purpose:
       This template is a plan chooser dialog.

       This template contains an HTML fragment which is used to pick
       templates, shared plans, individual plans, and new plans.

   Author:
        Andrew Jennings, David Zwarg

{% endcomment %}
<div id="PlanChooser" title = "Choose a Plan. {% if is_registered %} Start Drawing.{% endif %}">


  <ul id="TemplateTypeButtons">
    {% if is_registered %}
    <li id="btnTemplate">Template</li>
    {% endif %}
    <li id="btnShared">Shared Plans</li>
    {% if is_registered %}
    <li id="btnMine">Plans saved by {{ user }}</li>
    <li id="btnBlank">Blank Map</li> 
    <li id="btnUpload">Upload Blockfile</li>
    <li id="btnPlanTable">View Table</li>
    {% endif %}
  </ul>

<div id="TemplateTypeContent">
    <div id="SelectorsHelp">
        {% if upload %}
            {% if upload_status %}
        Thanks! Your file has been uploaded, and your plan is being constructed. When your plan is completely constructed, you will receive an email from us.
            {% else %}
        We're sorry! Your file was transferred to us, but there was a problem converting it into a plan. Make sure the file is a zipped block equivalency file, and please try again.
                {% if not user.email %}
                <br/><br/>
        In addition, please ensure that you provided an email address in the upload form, so we can let you know when your plan is ready.
                {% endif %}
            {% endif %}
        {% else %}
        To start, click on a button to determine which kind of template you'll be using.
        {% endif %}
    </div>

    <form method="POST" enctype="multipart/form-data" action="/districtmapping/plan/upload/" id="frmUpload">
    <div id="TemplateSelectors">
    <div id="TemplateSelection" class="SelectionGroup" >
    {% if templates %}
        <label>Select a Template</label>
        <select id="ddlTemplate" class="Selectors" >
        {% for plan in templates %}
            <option value="{{ plan.id }}">{{ plan.name }}</option>
        {% endfor %}
        </select>
    {% else %}
        <span class="Selectors">Sorry, no templates are available at this time.</span>
    {% endif %}
        </div>
        <div id="SharedSelection" class="SelectionGroup" >
    {% if shared %}
        <select id="ddlShared" class="Selectors">
        {% for plan in shared %}
            <option value="{{ plan.id }}">{{ plan.owner.username}}'s plan: {{ plan.name }}</option>
        {% endfor %}
        </select>
    {% else %}<span class="Selectors">Sorry, no shared plans are available at this time.</span>
    {% endif %}
        </div>
        <div id="TableSelection" class="SelectionGroup">
            <table id="tblPlans"></table>
            <div id="tblPlansPager"></div>
        </div>    
        <div id="MineSelection" class="SelectionGroup" >
            <label>Select a Plan</label>
    {% if mine %}
            <select id="ddlMine" class="Selectors">
            {% for plan in mine %}
                <option value="{{ plan.id }}">{{ plan.name }}</option>
            {% endfor %}
            </select>
            <div>
                <input type="radio" name="Edit" value="edit" checked>Edit Selected Plan</input>
                <input type="radio" name="Edit" value="saveas">Copy and Save Selected Plan</input>
            </div>
    {% else %}
            <span class="Selectors">Sorry, you have no plans available at this time.</span>
    {% endif %}
        </div>
        <div id="UploadSelection" class="SelectionGroup">
            <label>Upload a District Index file:</label>
            <input type="file" id="indexFile" name="indexFile"/>
            {% if user.email %}
            <input type="hidden" id="userEmail" name="userEmail" value="{{ user.email }}"/>
            {% else %}
            <div>
                <p>Please enter your email address. It will not be saved or shared.</p>
                <input type="text" id="userEmail" name="userEmail"/>
            </div>
            {% endif %}
        </div>
    </div>

{% if is_registered %}
    <div id="NewName">
        <label for="txtNewName" id="lblNewName">Name your new plan:</label>
        <input type="text" id="txtNewName" name="txtNewName"/>
    </div>
    {% for body in bodies %}
        {% if forloop.first and forloop.last %}
            <input type="hidden" id="legislativeBody" name="legislativeBody" value="{{ body.id }}"/>
        {% else %}
            <!-- more that one legislative body! what to do? -->
        {% endif %}
    {% endfor %}
    <button id="btnSelectPlan" type="submit">Start Drawing</button>
{% else %}
{% if shared %}
    <button id="btnSelectPlan" type="submit">View Plan</button>
{% endif %}
{% endif %}
    </form>
</div>

</div>
